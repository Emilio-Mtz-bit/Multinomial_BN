---
title: "Optimal DAG (Viajes)"
author: ""
format: html
editor: visual
---
```{r}
data = read.csv("DF_DAG(Viajes).csv")
data[] <- lapply(data, as.factor)
data = subset(data, select = -edad)
data = subset(data, select = -sexo)
```

```{r}
data
```

```{r}
cat("Datos faltantes por variable:\n")
colSums(is.na(data))

```
```{r}
# Eliminar filas con datos faltantes
data_clean = na.omit(data)
cat("\nFilas originales:", nrow(data))
cat("\nFilas después de eliminar NA:", nrow(data_clean))
```



#DAG 1

```{r}
dag1 = empty.graph(nodes = c("entidad", "used_auto", "used_autobusM1", "used_bicicleta", 
                             "used_autobus", "used_caminar", "estrato", "tam_localidad"
                            , "motorizado", "no_motorizado", 
                             "hora_cat", "duracion_min", "viaje_corto"))

arc_set1 = matrix(c(
  "entidad", "estrato",
  "entidad", "tam_localidad",
  "estrato", "motorizado",
  "estrato", "no_motorizado",
  "tam_localidad", "motorizado",
  "tam_localidad", "no_motorizado",
  "motorizado", "used_auto",
  "motorizado", "used_autobusM1",
  "motorizado", "used_autobus",
  "no_motorizado", "used_bicicleta",
  "no_motorizado", "used_caminar",
  "hora_cat", "duracion_min",
  "used_auto", "duracion_min",
  "used_autobusM1", "duracion_min",
  "used_autobus", "duracion_min",
  "used_bicicleta", "duracion_min",
  "used_caminar", "duracion_min",
  "duracion_min", "viaje_corto"
), byrow = TRUE, ncol = 2,
dimnames = list(NULL, c("from", "to")))

```

```{r}
arcs(dag1) = arc_set1
dag1
```

```{r}
graphviz.plot(dag1, shape = "ellipse")
```
## Evaluacion de la Primera DAG
```{r}
bn_mle1 = bn.fit(dag1, data = data_clean, method = "mle")
score(dag1, data = data_clean, type = "bic")
```
```{r}
arc.strength(dag1, data = data_clean, criterion = "mi")
```







# DAG 2
```{r}
dag2 = empty.graph(nodes = c("entidad", "used_auto", "used_autobusM1", "used_bicicleta", 
                             "used_autobus", "used_caminar", "estrato", "tam_localidad"
                            , "motorizado", "no_motorizado", 
                             "hora_cat", "duracion_min", "viaje_corto"))

arc_set2 = matrix(c(
  "entidad", "estrato",
  "entidad", "tam_localidad",
  "estrato", "motorizado",
  "estrato", "no_motorizado",
  "tam_localidad", "motorizado",
  "tam_localidad", "no_motorizado",
  "estrato", "used_auto",
  "estrato", "used_autobusM1",
  "estrato", "used_autobus",
  "estrato", "used_bicicleta",
  "estrato", "used_caminar",
  "tam_localidad", "used_auto",
  "tam_localidad", "used_autobusM1",
  "tam_localidad", "used_autobus",
  "tam_localidad", "used_bicicleta",
  "tam_localidad", "used_caminar",
  "motorizado", "used_auto",
  "motorizado", "used_autobusM1",
  "motorizado", "used_autobus",
  "no_motorizado", "used_bicicleta",
  "no_motorizado", "used_caminar",
  "hora_cat", "duracion_min",
  "used_auto", "duracion_min",
  "used_autobusM1", "duracion_min",
  "used_autobus", "duracion_min",
  "used_bicicleta", "duracion_min",
  "used_caminar", "duracion_min",
  "duracion_min", "viaje_corto"
), byrow = TRUE, ncol = 2,
dimnames = list(NULL, c("from", "to")))


```

```{r}
arcs(dag2) = arc_set2
dag2
```

```{r}
graphviz.plot(dag2, shape = "ellipse")
```

## Evaluacion DAG 2
```{r}
bn_mle2 = bn.fit(dag2, data = data_clean, method = "mle")
score(dag2, data = data_clean, type = "bic")
```

```{r}
arc.strength(dag2, data = data_clean, criterion = "mi")
```






#Best DAG (Hill Climbing)

```{r}
best_dag = hc(data_clean, type = "bic")
```

```{r}
graphviz.plot(best_dag, shape = "ellipse")
```
## Evaluacion Best DAG


```{r}
bn_mle_best = bn.fit(best_dag, data = data_clean, method = "mle")
score(best_dag, data = data_clean, type = "bic")
```
```{r}
arc.strength(best_dag, data = data_clean, criterion = "mi")
```



# Comparacion de la tres DAGS

```{r}
score_dag1 = score(dag1, data = data_clean, type = "bic")
score_dag2 = score(dag2, data = data_clean, type = "bic")
score_dag3 = score(best_dag, data = data_clean, type = "bic")

cat("Score BIC DAG 1:", score_dag1, "\n")
cat("Score BIC DAG 2:", score_dag2, "\n")
cat("Score BIC DAG 3:", score_dag3, "\n")
```


# Query 4

¿Cuál es la probabilidad de que un viaje con duración menor a 40 minutos se realice en transporte motorizado versus un viaje con transporte no motorizado?

```{r}
cpquery(bn_mle_best, event = ((motorizado == "No")&(no_motorizado == "Si")), evidence = (viaje_corto == "Menos_40min"), n = 10^6)
```

```{r}
cpquery(bn_mle_best, event = ((motorizado == "Si")&(no_motorizado == "No")), evidence = (viaje_corto == "Menos_40min"), n = 10^6)
```
Como podemos ver aqui es mayor la probabilidad de que los viajes menores a 40 min se realicen en transportes no motorizados, la diferencia de probabilidad no es mucha pero esto concuerda con las ultimas tendencias que se han dado en el valle de Mexico, ya que se esta optando en usar mejor bicicletas o irse caminando debido a que el trafico en las zomas urbanas es muy pesado y muchas veces haces menos tiempo en transportes no motorizados

